#!/bin/bash

# prepare gitlab config
mv /tmp/gitlab.rb /etc/gitlab/gitlab.rb
# run the configure
gitlab-ctl reconfigure >/dev/null 2>&1 &
# capture reconfigure pid
last_pid=$!
# sleep for config to complete
sleep 180
# seed db
echo yes | /usr/bin/gitlab-rake gitlab:setup
# remove process tree
/usr/local/bin/killtree $last_pid KILL

