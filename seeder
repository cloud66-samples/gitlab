#!/bin/bash

echo "prepare gitlab config.."
mv /tmp/gitlab.rb /etc/gitlab/gitlab.rb
echo "run the configure.."
bin/bash -c "gitlab-ctl reconfigure" >/dev/null 2>&1 &
last_pid=$!
echo "captured reconfigure pid id $last_pid"
echo "sleep for config to complete.."
sleep 180
echo "seeding db.."
echo yes | /usr/bin/gitlab-rake gitlab:setup
echo "removing process tree.."
/usr/local/bin/killtree $last_pid KILL
echo "DONE!"
